name: Mutation Test Generation Workflow (DEV)
on:
  push:
    branches:
      - dev
      - feature/*
  workflow_dispatch:  # Allow manual trigger

jobs:
  mutation-test-generation-dev:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with: 
          submodules: recursive

      - name: Install Foundry
        uses: foundry-rs/foundry-toolchain@v1

      - name: Run forge install 
        run: |
          forge install

      - name: Mutation Test Generator (DEV Environment)
        uses: olympix/mutation-test-generator@main
        env:
          OLYMPIX_API_TOKEN: ${{ secrets.OLYMPIX_API_TOKEN }}
          OLYMPIX_API_URL: https://api.olympixscantest.com/api/v1  # DEV API endpoint (full path)
          OLYMPIX_API_WS_URL: wss://api.olympixscantest.com/api/v1/client-ide-ws  # DEV WebSocket endpoint
          OLYMPIX_FAIL_MUTATION_GHA_THRESHOLD: 30
          OLYMPIX_GITHUB_COMMIT_HEAD_SHA: ${{ github.sha }}
          GITHUB_REPOSITORY_ID: ${{ github.repository_id }}  # Required for GitHub App
          OPIX_DEBUG: true  # Enable debug logging
        with:
          args: -w . -env -p src/ReentrancyAttack.sol -p src/SavingsAccount.sol
